<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L96D9CXWFY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-L96D9CXWFY');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Default Meta (Updated dynamically by JS) -->
    <meta name="description" id="meta-description"
        content="‡¶®‡ßã‡¶ô‡¶∞ - ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶ï‡ßç‡¶≤‡ßã‡¶¶‡¶ø‡¶Ç ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡•§ Premium Bangladeshi clothing brand.">
    <meta name="theme-color" content="#3D405B">

    <!-- Open Graph / Facebook / WhatsApp (Updated dynamically) -->
    <meta property="fb:app_id" content="966242223397117">
    <meta property="og:type" content="product">
    <meta property="og:url" id="og-url" content="https://nongor-brand.vercel.app/product.html">
    <meta property="og:title" id="og-title" content="‡¶®‡ßã‡¶ô‡¶∞ | Product">
    <meta property="og:description" id="og-description"
        content="Premium Bangladeshi clothing with handcrafted heritage.">
    <meta property="og:image" id="og-image" content="https://nongor-brand.vercel.app/assets/logo.jpeg">
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="800">
    <meta property="og:locale" content="bn_BD">
    <meta property="og:site_name" content="‡¶®‡ßã‡¶ô‡¶∞ - Nongor">
    <meta property="product:price:amount" id="og-price" content="0">
    <meta property="product:price:currency" content="BDT">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitter-title" content="‡¶®‡ßã‡¶ô‡¶∞ | Product">
    <meta name="twitter:description" id="twitter-description"
        content="Premium Bangladeshi clothing with handcrafted heritage.">
    <meta name="twitter:image" id="twitter-image" content="https://nongor-brand.vercel.app/assets/logo.jpeg">

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" sizes="32x32" href="./assets/logo.jpeg">
    <link rel="apple-touch-icon" href="./assets/logo.jpeg">
    <link rel="manifest" href="/manifest.json">

    <title id="page-title">‡¶®‡ßã‡¶ô‡¶∞ | Product</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400&family=Montserrat:wght@300;400;500;600&family=Noto+Serif+Bengali:wght@400;500;600;700&family=Tiro+Bangla:ital@0;1&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <link href="./assets/styles.css" rel="stylesheet">
    <!-- Custom Animations & Polish -->
    <link href="./assets/animations.css" rel="stylesheet">
</head>

<body class="bg-white font-sans text-brand-deep antialiased">

    <!-- Simple Header -->
    <header class="bg-white/95 backdrop-blur-xl sticky top-0 z-50 shadow-sm border-b border-gray-100">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-3">
                <img src="./assets/logo.jpeg" alt="‡¶®‡ßã‡¶ô‡¶∞" class="h-10 rounded-lg">
                <span class="text-2xl font-serif font-bold text-brand-deep">‡¶®‡ßã‡¶ô‡¶∞</span>
            </a>
            <a href="index.html#collection"
                class="text-sm font-medium text-gray-600 hover:text-brand-terracotta transition">‚Üê Back to Shop</a>
        </div>
    </header>

    <!-- Loading State -->
    <!-- Loading State -->
    <div id="product-loading"
        class="flex flex-col items-center justify-center min-h-[80vh] w-full bg-white fixed inset-0 z-40 pt-20">
        <div class="relative flex flex-col items-center">
            <!-- Premium Spinner -->
            <div
                class="w-16 h-16 border-4 border-brand-terracotta/20 border-t-brand-terracotta rounded-full animate-spin mb-4">
            </div>

            <!-- Brand Pulse -->
            <div class="absolute top-0 left-0 w-16 h-16 bg-brand-terracotta/10 rounded-full animate-ping opacity-75">
            </div>

            <!-- Text -->
            <h3 class="mt-4 text-xl font-serif text-brand-deep tracking-widest uppercase animate-pulse">Nongor</h3>
            <p class="text-xs text-gray-400 font-sans tracking-wide mt-1">Wait for a moment...</p>
        </div>
    </div>

    <!-- Error State -->
    <div id="product-error" class="hidden flex items-center justify-center min-h-[60vh]">
        <div class="text-center px-6">
            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h2 class="text-xl font-bold text-gray-700 mb-2">Product Not Found</h2>
            <p class="text-gray-500 mb-6">The product you're looking for doesn't exist or has been removed.</p>
            <a href="index.html#collection"
                class="inline-block bg-brand-deep text-white px-6 py-3 rounded-xl font-medium hover:bg-brand-terracotta transition">Browse
                Collection</a>
        </div>
    </div>

    <!-- Product Content -->
    <main id="product-content" class="hidden max-w-6xl mx-auto px-4 py-8">
        <div class="grid md:grid-cols-2 gap-8 lg:gap-12">

            <!-- Image Gallery -->
            <div class="space-y-4 animate-fade-in-up">
                <!-- Main Image -->
                <div class="aspect-[4/5] bg-gray-50 rounded-2xl overflow-hidden shadow-lg img-zoom">
                    <img id="main-image" src="" alt=""
                        class="w-full h-full object-cover transition-transform duration-500" loading="lazy">
                </div>
                <!-- Thumbnails -->
                <div id="thumbnails" class="flex gap-3 overflow-x-auto pb-2 animate-slide-in-left anim-delay-2"></div>
            </div>

            <!-- Product Info -->
            <div class="flex flex-col animate-slide-in-right">
                <!-- Category -->
                <p id="product-category"
                    class="text-xs uppercase tracking-widest text-brand-terracotta font-bold mb-2 anim-delay-1">
                </p>

                <!-- Title -->
                <h1 id="product-title"
                    class="text-3xl md:text-4xl font-serif font-bold text-brand-deep mb-4 gradient-text"></h1>

                <!-- Price -->
                <div class="flex items-baseline gap-3 mb-6">
                    <span id="product-price" class="text-3xl font-bold text-brand-deep"></span>
                    <span class="text-sm text-gray-400 line-through" id="product-original-price"></span>
                </div>

                <!-- Stock Status -->
                <div id="stock-status" class="flex items-center gap-2 mb-6"></div>

                <!-- Description -->
                <p id="product-description" class="text-gray-600 leading-relaxed mb-8"></p>

                <!-- Size Selector -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <label class="block text-sm font-bold text-gray-700">Size</label>
                        <div class="flex p-1 bg-gray-100 rounded-lg">
                            <button onclick="window.toggleSizeType('standard')" id="btn-size-standard"
                                class="px-3 py-1 rounded-md text-xs font-bold transition-all bg-white shadow-sm text-brand-deep border border-gray-200">Standard</button>
                            <button onclick="window.toggleSizeType('custom')" id="btn-size-custom"
                                class="px-3 py-1 rounded-md text-xs font-bold transition-all text-gray-500 hover:text-brand-deep">Custom
                                Size</button>
                        </div>
                    </div>

                    <!-- Standard Selector -->
                    <div id="size-selector" class="flex flex-wrap gap-3 mb-3"></div>

                    <!-- Custom Form (Hidden by default) -->
                    <div id="custom-size-form"
                        class="hidden bg-gray-50 p-4 rounded-xl border border-gray-200 animate-fade-in text-left">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-xs font-bold uppercase tracking-wider text-gray-500">Enter Measurements</h4>
                            <div class="flex bg-white rounded border border-gray-200">
                                <button onclick="window.toggleUnit('inch')" id="btn-unit-inch"
                                    class="px-2 py-0.5 text-xs font-bold bg-brand-terracotta text-white rounded-l">IN</button>
                                <button onclick="window.toggleUnit('cm')" id="btn-unit-cm"
                                    class="px-2 py-0.5 text-xs font-bold text-gray-500 rounded-r">CM</button>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div>
                                <label class="text-[10px] uppercase text-gray-400 font-bold block mb-1">Bust</label>
                                <input type="number" data-measure="bust"
                                    class="w-full p-2 text-sm border border-gray-200 rounded focus:border-brand-terracotta outline-none"
                                    placeholder="0">
                            </div>
                            <div>
                                <label class="text-[10px] uppercase text-gray-400 font-bold block mb-1">Waist</label>
                                <input type="number" data-measure="waist"
                                    class="w-full p-2 text-sm border border-gray-200 rounded focus:border-brand-terracotta outline-none"
                                    placeholder="0">
                            </div>
                            <div>
                                <label class="text-[10px] uppercase text-gray-400 font-bold block mb-1">Hip</label>
                                <input type="number" data-measure="hip"
                                    class="w-full p-2 text-sm border border-gray-200 rounded focus:border-brand-terracotta outline-none"
                                    placeholder="0">
                            </div>
                            <div>
                                <label class="text-[10px] uppercase text-gray-400 font-bold block mb-1">Shoulder</label>
                                <input type="number" data-measure="shoulder"
                                    class="w-full p-2 text-sm border border-gray-200 rounded focus:border-brand-terracotta outline-none"
                                    placeholder="0">
                            </div>
                            <div>
                                <label class="text-[10px] uppercase text-gray-400 font-bold block mb-1">Length</label>
                                <input type="number" data-measure="length"
                                    class="w-full p-2 text-sm border border-gray-200 rounded focus:border-brand-terracotta outline-none"
                                    placeholder="0">
                            </div>
                            <div>
                                <label class="text-[10px] uppercase text-gray-400 font-bold block mb-1">Sleeve</label>
                                <input type="number" data-measure="sleeve"
                                    class="w-full p-2 text-sm border border-gray-200 rounded focus:border-brand-terracotta outline-none"
                                    placeholder="0">
                            </div>
                        </div>

                        <div>
                            <label class="text-[10px] uppercase text-gray-400 font-bold block mb-1">Note
                                (Optional)</label>
                            <textarea id="custom-note" rows="2"
                                class="w-full p-2 text-sm border border-gray-200 rounded focus:border-brand-terracotta outline-none"
                                placeholder="Any specific requirements..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Quantity -->
                <div class="mb-8">
                    <label class="block text-sm font-bold text-gray-700 mb-3">Quantity</label>
                    <div class="flex items-center gap-4">
                        <button onclick="updateQty(-1)"
                            class="w-10 h-10 rounded-full border-2 border-gray-200 flex items-center justify-center hover:border-brand-terracotta transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4">
                                </path>
                            </svg>
                        </button>
                        <span id="qty-display" class="text-xl font-bold w-8 text-center">1</span>
                        <button onclick="updateQty(1)"
                            class="w-10 h-10 rounded-full border-2 border-gray-200 flex items-center justify-center hover:border-brand-terracotta transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 mb-8">
                    <button id="btn-add-cart" onclick="addToCartFromPage()"
                        class="flex-1 bg-white border-2 border-brand-deep text-brand-deep py-4 rounded-xl font-bold hover:bg-brand-deep hover:text-white transition-all duration-300 flex items-center justify-center gap-2 ripple hover:-translate-y-1 hover:shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                            </path>
                        </svg>
                        Add to Cart
                    </button>
                    <button id="btn-buy-now" onclick="buyNowFromPage()"
                        class="flex-1 bg-gradient-to-r from-brand-deep to-brand-terracotta text-white py-4 rounded-xl font-bold transition-all duration-300 shadow-lg btn-premium shine animate-pulse-glow">
                        Buy Now
                    </button>
                </div>

                <!-- Shipping Info -->
                <div
                    class="bg-gradient-to-br from-gray-50 to-white rounded-xl p-5 space-y-3 border border-gray-100 glass-light">
                    <div class="flex items-center gap-3 text-sm text-gray-600 animate-fade-in-up anim-delay-1">
                        <svg class="w-5 h-5 text-green-500 animate-bounce-in" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        <span>Free shipping on orders over ‡ß≥2000</span>
                    </div>
                    <div class="flex items-center gap-3 text-sm text-gray-600 animate-fade-in-up anim-delay-2">
                        <svg class="w-5 h-5 text-green-500 animate-bounce-in" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        <span>3-5 day delivery within Bangladesh</span>
                    </div>
                    <div class="flex items-center gap-3 text-sm text-gray-600 animate-fade-in-up anim-delay-3">
                        <svg class="w-5 h-5 text-green-500 animate-bounce-in" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        <span>Easy returns within 7 days</span>
                    </div>
                </div>

                <!-- Share Button -->
                <button onclick="shareProduct()"
                    class="mt-6 flex items-center justify-center gap-2 text-gray-500 hover:text-brand-terracotta transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z">
                        </path>
                    </svg>
                    Share this product
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white text-brand-deep pt-12 pb-6 border-t border-gray-100 mt-12">
        <div class="max-w-6xl mx-auto px-6 text-center">
            <p class="text-sm text-gray-400">¬© 2026 ‡¶®‡ßã‡¶ô‡¶∞ Brand. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Toast -->
    <div id="toast"
        class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white px-6 py-3 rounded-full shadow-xl border border-gray-100 hidden opacity-0 translate-y-20 transition-all duration-300 z-50 flex items-center gap-3">
        <div id="toast-icon" class="w-2 h-2 rounded-full bg-green-500"></div>
        <span id="toast-message" class="text-sm font-medium text-gray-700"></span>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-6 right-6 z-40 flex flex-col gap-4 items-end">
        <!-- WhatsApp Button -->
        <a href="https://wa.me/message/74UB552NKNJYG1" target="_blank"
            class="bg-green-500 text-white p-3.5 rounded-full shadow-2xl hover:bg-green-600 transition-all transform hover:scale-110 hover:-translate-y-1 relative group">
            <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24">
                <path
                    d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z" />
            </svg>
            <span
                class="absolute right-full mr-3 top-1/2 -translate-y-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap">Chat
                on WhatsApp</span>
        </a>
    </div>

    <!-- Scripts -->
    <script src="./script.js"></script>
    <script>
        // API_URL is defined in script.js
        // Local state for this page
        // Local state for this page
        window.quantity = 1;
        window.selectedSize = null;

        // Init on load
        document.addEventListener('DOMContentLoaded', async () => {
            // Reset state
            window.currentSizeType = 'standard';
            window.currentMeasurementUnit = 'inch';

            // 1. Check for Preloaded Data (SSR)
            if (window.preloadedProduct) {
                console.log('‚ö° Hydrating from SSR data...');
                currentProduct = window.preloadedProduct;
                renderProduct(currentProduct);
                // Tags already set by server, no need to updateMetaTags
                document.getElementById('product-loading').classList.add('hidden');
                document.getElementById('product-content').classList.remove('hidden');
                return;
            }

            // 2. Fallback: CSR (Client Side Rendering)
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');
            const productSlug = params.get('slug'); // Support slug param too

            if (!productId && !productSlug) {
                // Try to parse slug from URL path if using /p/slug via client nav (unlikely but good fallback)
                // path: /p/some-slug
                const pathParts = window.location.pathname.split('/');
                const pIndex = pathParts.indexOf('p');
                if (pIndex > -1 && pathParts[pIndex + 1]) {
                    await loadProduct(null, pathParts[pIndex + 1]);
                    return;
                }

                showError();
                return;
            }

            await loadProduct(productId, productSlug);
        });

        async function loadProduct(id, slug) {
            try {
                // Use dedicated single-product endpoint for efficiency
                let url = `${API_URL}?action=getProduct`;
                if (id) url += `&id=${encodeURIComponent(id)}`;
                else if (slug) url += `&slug=${encodeURIComponent(slug)}`;

                const res = await fetch(url);
                const data = await res.json();

                if (data.result !== 'success' || !data.data) {
                    showError();
                    return;
                }

                currentProduct = data.data;

                renderProduct(currentProduct);
                updateMetaTags(currentProduct);
                document.getElementById('product-loading').classList.add('hidden');
                document.getElementById('product-content').classList.remove('hidden');

            } catch (e) {
                console.error(e);
                showError();
            }
        }

        function showError() {
            document.getElementById('product-loading').classList.add('hidden');
            document.getElementById('product-error').classList.remove('hidden');
        }

        function renderProduct(product) {
            // Title
            document.getElementById('product-title').textContent = product.name;
            document.getElementById('page-title').textContent = `${product.name} | ‡¶®‡ßã‡¶ô‡¶∞`;

            // Category
            document.getElementById('product-category').textContent = product.category_name || 'Collection';

            // Price
            document.getElementById('product-price').textContent = `‡ß≥${parseFloat(product.price).toLocaleString()}`;

            // Description
            document.getElementById('product-description').textContent = product.description || 'Premium quality Bangladeshi clothing.';

            const stock = parseInt(product.stock_quantity) || 0;
            window.maxStock = stock; // Store for quantity limiter
            const stockEl = document.getElementById('stock-status');
            if (stock > 0) {
                stockEl.innerHTML = `<span class="w-2 h-2 bg-green-500 rounded-full"></span><span class="text-sm text-green-600 font-medium">In Stock (${stock} available)</span>`;
            } else {
                stockEl.innerHTML = `<span class="w-2 h-2 bg-red-500 rounded-full"></span><span class="text-sm text-red-600 font-medium">Out of Stock</span>`;
                document.getElementById('btn-add-cart').disabled = true;
                document.getElementById('btn-buy-now').disabled = true;
            }

            // Main Image
            const mainImg = document.getElementById('main-image');
            const imgSrc = product.image?.startsWith('http') ? product.image : `./assets/${product.image || 'logo.jpeg'}`;
            mainImg.src = imgSrc;
            mainImg.alt = product.name;

            // Thumbnails
            const thumbContainer = document.getElementById('thumbnails');
            let images = [product.image];
            if (product.images && Array.isArray(product.images)) {
                images = [...new Set([product.image, ...product.images])].filter(Boolean);
            }
            thumbContainer.innerHTML = images.map((img, i) => {
                const src = img?.startsWith('http') ? img : `./assets/${img || 'logo.jpeg'}`;
                return `<img src="${src}" alt="Thumbnail ${i + 1}" onclick="changeMainImage('${src}')" class="w-16 h-20 object-cover rounded-lg cursor-pointer border-2 ${i === 0 ? 'border-brand-terracotta' : 'border-gray-200'} hover:border-brand-terracotta transition">`;
            }).join('');

            // Sizes (Populate Standard Selector)
            const sizes = ['S', 'M', 'L', 'XL', 'XXL'];
            document.getElementById('size-selector').innerHTML = sizes.map(s => `
                <button onclick="selectSize('${s}')" class="size-btn px-4 py-2 border-2 rounded-lg font-medium transition ${s === window.selectedSize ? 'border-brand-terracotta bg-brand-terracotta/10 text-brand-terracotta' : 'border-gray-200 text-gray-600 hover:border-brand-terracotta'}">${s}</button>
            `).join('');

            // Initialize UI state
            if (window.updateSizeTypeUI) window.updateSizeTypeUI();
        }

        function updateMetaTags(product) {
            const url = window.location.href;
            const imgSrc = product.image?.startsWith('http') ? product.image : `https://nongor-brand.vercel.app/assets/${product.image || 'logo.jpeg'}`;
            const desc = product.description || 'Premium quality Bangladeshi clothing from Nongor.';

            document.getElementById('meta-description').content = desc;
            document.getElementById('og-url').content = url;
            document.getElementById('og-title').content = `${product.name} | ‡¶®‡ßã‡¶ô‡¶∞`;
            document.getElementById('og-description').content = desc;
            document.getElementById('og-image').content = imgSrc;
            document.getElementById('og-price').content = product.price;
            document.getElementById('twitter-title').content = `${product.name} | ‡¶®‡ßã‡¶ô‡¶∞`;
            document.getElementById('twitter-description').content = desc;
            document.getElementById('twitter-image').content = imgSrc;
        }

        function changeMainImage(src) {
            document.getElementById('main-image').src = src;
            document.querySelectorAll('#thumbnails img').forEach(img => {
                img.classList.toggle('border-brand-terracotta', img.src === src);
                img.classList.toggle('border-gray-200', img.src !== src);
            });
        }

        function selectSize(size) {
            window.selectedSize = size;
            document.querySelectorAll('.size-btn').forEach(btn => {
                const isSelected = btn.textContent.trim() === size;
                btn.classList.toggle('border-brand-terracotta', isSelected);
                btn.classList.toggle('bg-brand-terracotta/10', isSelected);
                btn.classList.toggle('text-brand-terracotta', isSelected);
                btn.classList.toggle('border-gray-200', !isSelected);
                btn.classList.toggle('text-gray-600', !isSelected);
            });
        }

        function updateQty(delta) {
            const maxQty = Math.min(10, window.maxStock || 10);
            window.quantity = Math.min(maxQty, Math.max(1, window.quantity + delta));
            document.getElementById('qty-display').textContent = window.quantity;
        }

        function addToCartFromPage() {
            if (!currentProduct) return;

            // Validation logic reused/adapted from script.js
            let finalSize = window.selectedSize;
            let measurements = null;
            let sizeType = 'standard';
            let unit = 'inch';
            let notes = '';

            if (window.currentSizeType === 'custom') {
                if (window.getAndValidateMeasurements) {
                    const val = window.getAndValidateMeasurements();
                    if (!val.valid) return;

                    sizeType = 'custom';
                    measurements = val.measurements;
                    unit = val.unit;
                    notes = val.notes;
                    finalSize = `Custom (${unit})`;
                }
            } else {
                if (!window.selectedSize) {
                    showToast('Please select a size', 'error');
                    return;
                }
            }

            const cart = JSON.parse(localStorage.getItem('nongor_cart')) || [];
            cart.push({
                id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                image: currentProduct.image,
                size: finalSize,
                sizeType: sizeType,
                unit: unit,
                measurements: measurements,
                notes: notes,
                quantity: window.quantity,
                timestamp: Date.now()
            });
            localStorage.setItem('nongor_cart', JSON.stringify(cart));

            // Update Cart UI if function exists
            if (window.updateCartUI) window.updateCartUI();
            if (window.openCart) window.openCart();

            showToast('Added to cart! üõí');
        }

        function buyNowFromPage() {
            if (!currentProduct) return;

            // Validation logic
            let finalSize = window.selectedSize;
            let measurements = null;
            let sizeType = 'standard';
            let unit = 'inch';
            let notes = '';

            if (window.currentSizeType === 'custom') {
                if (window.getAndValidateMeasurements) {
                    const val = window.getAndValidateMeasurements();
                    if (!val.valid) return;

                    sizeType = 'custom';
                    measurements = val.measurements;
                    unit = val.unit;
                    notes = val.notes;
                    finalSize = `Custom (${unit})`;
                }
            } else {
                if (!window.selectedSize) {
                    showToast('Please select a size', 'error');
                    return;
                }
            }

            const buyNowItem = [{
                id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                image: currentProduct.image,
                size: finalSize,
                sizeType: sizeType,
                unit: unit,
                measurements: measurements,
                notes: notes,
                quantity: window.quantity
            }];
            localStorage.setItem('nongor_direct_buy', JSON.stringify(buyNowItem));
            window.location.href = `checkout.html?mode=direct`;
        }

        function shareProduct() {
            if (navigator.share) {
                navigator.share({
                    title: currentProduct.name + ' | ‡¶®‡ßã‡¶ô‡¶∞',
                    text: `Check out ${currentProduct.name} from Nongor!`,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('Link copied! üìã');
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('hidden', 'opacity-0', 'translate-y-20');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-20');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }
    </script>
</body>

</html>