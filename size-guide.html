<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kurti Size Guide - ‡¶®‡ßã‡¶ô‡¶∞</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Galada&family=Hind+Siliguri:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #F8F5F2;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .hero {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero h1 {
            font-family: 'Galada', cursive;
            font-size: 72px;
            color: #2A2C3E;
            margin-bottom: 20px;
        }

        .hero .highlight {
            background: linear-gradient(to right, #ec4899, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .model-card {
            background: white;
            padding: 40px;
            border-radius: 40px;
            box-shadow: 0 20px 60px rgba(236, 72, 153, 0.15);
        }

        .model-container {
            position: relative;
            width: 100%;
            height: 650px;
            border-radius: 24px;
            overflow: hidden;
            background: radial-gradient(ellipse at center, #ffffff, #fef3f8, #ffe4f0);
        }

        #canvas {
            width: 100%;
            height: 100%;
        }

        .label {
            position: absolute;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 245, 250, 0.98));
            backdrop-filter: blur(15px);
            padding: 14px 24px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 700;
            color: #1a1a1a;
            box-shadow: 0 10px 40px rgba(236, 72, 153, 0.3), 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2.5px solid rgba(236, 72, 153, 0.5);
            z-index: 20;
            opacity: 0;
            transform: scale(0.85);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .label.show {
            opacity: 1;
            transform: scale(1);
        }

        .label::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #ec4899 0%, #db2777 70%);
            border-radius: 50%;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.9), 0 0 25px rgba(236, 72, 153, 0.5);
            animation: glow 2.5s ease-in-out infinite;
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 15px rgba(236, 72, 153, 0.9);
                transform: translateY(-50%) scale(1);
            }

            50% {
                box-shadow: 0 0 25px rgba(236, 72, 153, 1);
                transform: translateY(-50%) scale(1.1);
            }
        }

        .label-text {
            display: block;
            color: #444;
            font-size: 11px;
            font-weight: 600;
            margin-left: 16px;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .label-value {
            color: #ec4899;
            font-weight: 900;
            margin-left: 16px;
            font-size: 16px;
            display: block;
            text-shadow: 0 1px 2px rgba(236, 72, 153, 0.3);
        }

        .label-desc {
            color: #666;
            font-size: 10px;
            margin-left: 16px;
            margin-top: 2px;
            font-weight: 500;
            display: block;
        }

        .line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(236, 72, 153, 0.9) 20%, rgba(236, 72, 153, 1) 50%, rgba(236, 72, 153, 0.9) 80%, transparent);
            z-index: 15;
            opacity: 0;
            transition: opacity 0.5s;
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.6);
        }

        .line.show {
            opacity: 1;
        }

        .ring {
            position: absolute;
            border: 3px solid rgba(236, 72, 153, 0.7);
            border-radius: 50%;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.5s;
            box-shadow: 0 0 25px rgba(236, 72, 153, 0.5), inset 0 0 25px rgba(236, 72, 153, 0.3);
        }

        .ring.show {
            opacity: 1;
            animation: pulse-ring 3.5s ease-in-out infinite;
        }

        @keyframes pulse-ring {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.7;
                border-color: rgba(236, 72, 153, 0.7);
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
                border-color: rgba(236, 72, 153, 1);
            }
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.98);
            padding: 16px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }

        .btn {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, #ec4899, #db2777);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4);
        }

        .btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.6);
        }

        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 16px 20px;
            border-radius: 16px;
            font-size: 12px;
            max-width: 220px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .info-title {
            color: #ec4899;
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .cards {
            margin-top: 32px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .card {
            background: linear-gradient(to bottom right, #fce7f3, rgba(252, 231, 243, 0.5));
            padding: 16px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(236, 72, 153, 0.2);
        }

        .card-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .card-title {
            font-weight: 700;
            color: #9f1239;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .card-desc {
            font-size: 10px;
            color: #666;
            font-family: 'Hind Siliguri', sans-serif;
        }

        .card-value {
            color: #ec4899;
            font-weight: 700;
            font-size: 14px;
            margin-top: 8px;
        }

        .chart-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(236, 72, 153, 0.15);
            overflow: hidden;
        }

        .chart-header {
            background: linear-gradient(to right, #ec4899, #db2777);
            padding: 24px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
        }

        .chart-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #fce7f3;
            color: #9f1239;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        th {
            padding: 16px;
            text-align: center;
        }

        th:first-child {
            text-align: left;
            padding-left: 32px;
        }

        tbody tr {
            border-bottom: 1px solid #fce7f3;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: rgba(252, 231, 243, 0.5);
        }

        tbody tr:nth-child(even) {
            background: rgba(252, 231, 243, 0.2);
        }

        td {
            padding: 16px;
            text-align: center;
            color: #666;
            font-weight: 500;
        }

        td:first-child {
            text-align: left;
            padding-left: 32px;
            font-weight: 700;
            color: #db2777;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(236, 72, 153, 0.2);
            border-top: 5px solid #ec4899;
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 20px;
            color: #ec4899;
            font-weight: 700;
            font-size: 15px;
            animation: pulse-text 2s ease-in-out infinite;
        }

        @keyframes pulse-text {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="hero">
            <h1><span class="highlight">‡¶ï‡ßÅ‡¶∞‡ßç‡¶§‡¶ø</span> ‡¶∏‡¶æ‡¶á‡¶ú ‡¶ó‡¶æ‡¶á‡¶°</h1>
            <p style="font-family: 'Hind Siliguri', sans-serif; font-size: 18px; color: #666;">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßÄ ‡¶´‡¶ø‡¶ü‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç
                ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶Æ‡¶æ‡¶•‡¶æ‡¶Ø‡¶º ‡¶∞‡ßá‡¶ñ‡ßá ‡¶§‡ßà‡¶∞‡¶ø</p>
        </div>

        <div class="grid">
            <div class="model-card">
                <h3
                    style="font-family: 'Playfair Display', serif; font-size: 28px; text-align: center; color: #9f1239; margin-bottom: 10px;">
                    How to Measure</h3>
                <p
                    style="font-family: 'Hind Siliguri', sans-serif; font-size: 14px; text-align: center; color: #666; margin-bottom: 24px;">
                    ‡¶´‡¶ü‡ßã‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡¶ø‡¶ï 3D ‡¶Æ‡¶°‡ßá‡¶≤ - ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠</p>

                <div class="model-container">
                    <div id="loading" class="loading">
                        <div class="spinner"></div>
                        <p class="loading-text">Creating Realistic Model...</p>
                    </div>

                    <div class="info">
                        <div class="info-title">üí° Controls</div>
                        <div style="margin: 6px 0;"><strong>Drag</strong> ‚Ä¢ Rotate model</div>
                        <div style="margin: 6px 0;"><strong>Scroll</strong> ‚Ä¢ Zoom in/out</div>
                        <div style="margin: 6px 0;"><strong>Pinch</strong> ‚Ä¢ Mobile zoom</div>
                    </div>

                    <div id="canvas"></div>

                    <div class="controls">
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="toggleRotation()" id="btn-rotate">‚è∏</button>
                            <button class="btn" onclick="toggleLabels()" id="btn-labels">üëÅ</button>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="resetView()">‚Üª</button>
                            <button class="btn" onclick="toggleWireframe()" id="btn-wire">‚¨ö</button>
                        </div>
                    </div>
                </div>

                <div class="cards">
                    <div class="card">
                        <div class="card-icon">üìè</div>
                        <div class="card-title">BUST</div>
                        <div class="card-desc">‡¶¨‡ßÅ‡¶ï‡ßá‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡¶ø‡¶ß‡¶ø</div>
                        <div class="card-value">36"</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">üìê</div>
                        <div class="card-title">WAIST</div>
                        <div class="card-desc">‡¶ï‡ßã‡¶Æ‡¶∞‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶™</div>
                        <div class="card-value">27"</div>
                    </div>
                    <div class="card">
                        <div class="card-icon">üìä</div>
                        <div class="card-title">HIPS</div>
                        <div class="card-desc">‡¶®‡¶ø‡¶§‡¶Æ‡ßç‡¶¨‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶ß‡¶ø</div>
                        <div class="card-value">39"</div>
                    </div>
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 32px;">
                <div class="chart-card">
                    <div class="chart-header">
                        <h2>Kurti Base Size Chart</h2>
                        <span class="chart-badge">Inches</span>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Size (BD)</th>
                                <th>Chest</th>
                                <th>Waist</th>
                                <th>Hips</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>36 (S)</td>
                                <td>36"</td>
                                <td>32"</td>
                                <td>38"</td>
                            </tr>
                            <tr>
                                <td>38 (M)</td>
                                <td>38"</td>
                                <td>34"</td>
                                <td>40"</td>
                            </tr>
                            <tr>
                                <td>40 (L)</td>
                                <td>40"</td>
                                <td>36"</td>
                                <td>42"</td>
                            </tr>
                            <tr>
                                <td>42 (XL)</td>
                                <td>42"</td>
                                <td>38"</td>
                                <td>44"</td>
                            </tr>
                            <tr>
                                <td>44 (XXL)</td>
                                <td>44"</td>
                                <td>40"</td>
                                <td>46"</td>
                            </tr>
                            <tr>
                                <td>46 (3XL)</td>
                                <td>46"</td>
                                <td>42"</td>
                                <td>48"</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div
                    style="background: rgba(42, 44, 62, 0.05); padding: 24px; border-radius: 16px; border: 1px solid rgba(42, 44, 62, 0.1); text-align: center;">
                    <p style="font-family: 'Hind Siliguri', sans-serif; font-size: 14px; color: #666;">** ‡¶ï‡ßÅ‡¶∞‡ßç‡¶§‡¶ø‡¶∞ ‡¶≤‡ßá‡¶Ç‡¶•
                        (Length) ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá (‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡ß©‡ßÆ" - ‡ß™‡ß¨")‡•§ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡ßá‡¶ú‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§
                        ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, model, autoRotate = true, labelsVisible = true, wireframe = false;
        let materials = {};
        const measurements = {
            bust: { value: 36, pos: [0, 1.32, 0], desc: "Around fullest part" },
            waist: { value: 27, pos: [0, 0.92, 0], desc: "Natural waistline" },
            hips: { value: 39, pos: [0, 0.75, 0], desc: "Widest point" }
        };

        function init() {
            const container = document.getElementById('canvas');
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0xfef3f8, 10, 20);

            camera = new THREE.PerspectiveCamera(38, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0.3, 1.6, 5);
            camera.lookAt(0, 1.5, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.3;
            container.appendChild(renderer.domElement);

            setupLighting();
            createModel();
            createLabels();
            setupControls();

            setTimeout(() => document.getElementById('loading').classList.add('hidden'), 1200);
            animate();
        }

        function setupLighting() {
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            const keyLight = new THREE.DirectionalLight(0xffffff, 1.5);
            keyLight.position.set(4, 7, 5);
            keyLight.castShadow = true;
            keyLight.shadow.mapSize.width = 4096;
            keyLight.shadow.mapSize.height = 4096;
            scene.add(keyLight);
            scene.add(new THREE.DirectionalLight(0xffe9f5, 0.7).position.set(-4, 4, 3));
            scene.add(new THREE.DirectionalLight(0xffb8e6, 1.0).position.set(0, 5, -5));
            const topLight = new THREE.SpotLight(0xffffff, 0.6);
            topLight.position.set(0, 10, 0);
            scene.add(topLight);
            scene.add(new THREE.HemisphereLight(0xffffff, 0xffe4f0, 0.5));
        }

        function createModel() {
            model = new THREE.Group();
            materials.skin = new THREE.MeshStandardMaterial({ color: 0xf5d5c5, roughness: 0.55, metalness: 0.05 });
            materials.kurti = new THREE.MeshStandardMaterial({ color: 0xfce7f3, roughness: 0.65, metalness: 0.08 });
            materials.hair = new THREE.MeshStandardMaterial({ color: 0x2d1a12, roughness: 0.75, metalness: 0.15 });

            // HEAD
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.145, 48, 48), materials.skin);
            head.position.y = 1.78;
            head.scale.set(0.93, 1.18, 0.88);
            head.castShadow = true;
            model.add(head);

            // EYES
            const eyeGeo = new THREE.SphereGeometry(0.014, 24, 24);
            const eyeMat = new THREE.MeshBasicMaterial({ color: 0x1a0a00 });
            [-0.042, 0.042].forEach(x => {
                const eye = new THREE.Mesh(eyeGeo, eyeMat);
                eye.position.set(x, 1.80, 0.115);
                model.add(eye);
            });

            // NOSE
            const nose = new THREE.Mesh(new THREE.SphereGeometry(0.02, 24, 24), materials.skin);
            nose.position.set(0, 1.75, 0.135);
            nose.scale.set(0.7, 1.2, 1.5);
            model.add(nose);

            // HAIR
            const hairMain = new THREE.Mesh(new THREE.SphereGeometry(0.165, 48, 48), materials.hair);
            hairMain.position.set(0, 1.78, -0.02);
            hairMain.scale.set(0.98, 1.25, 1.4);
            hairMain.castShadow = true;
            model.add(hairMain);

            // NECK
            const neck = new THREE.Mesh(new THREE.CylinderGeometry(0.058, 0.068, 0.19, 32), materials.skin);
            neck.position.y = 1.61;
            neck.castShadow = true;
            model.add(neck);

            // SHOULDERS
            [-0.19, 0.19].forEach(x => {
                const shoulder = new THREE.Mesh(new THREE.SphereGeometry(0.085, 32, 32), materials.kurti);
                shoulder.position.set(x, 1.50, 0);
                shoulder.scale.set(1.3, 0.85, 0.95);
                shoulder.castShadow = true;
                model.add(shoulder);
            });

            // UPPER TORSO
            const upperTorso = new THREE.Mesh(new THREE.SphereGeometry(0.17, 48, 48), materials.kurti);
            upperTorso.position.y = 1.33;
            upperTorso.scale.set(1.35, 1.15, 1.0);
            upperTorso.castShadow = true;
            model.add(upperTorso);

            // BUST
            [-0.095, 0.095].forEach(x => {
                const bust = new THREE.Mesh(new THREE.SphereGeometry(0.115, 48, 48), materials.kurti);
                bust.position.set(x, 1.32, 0.105);
                bust.scale.set(0.98, 1.15, 0.92);
                bust.castShadow = true;
                model.add(bust);
            });

            // WAIST
            const waist = new THREE.Mesh(new THREE.CylinderGeometry(0.115, 0.135, 0.2, 48), materials.kurti);
            waist.position.y = 0.92;
            waist.castShadow = true;
            model.add(waist);

            // HIPS
            const hips = new THREE.Mesh(new THREE.SphereGeometry(0.16, 48, 48), materials.kurti);
            hips.position.y = 0.75;
            hips.scale.set(1.2, 0.88, 1.05);
            hips.castShadow = true;
            model.add(hips);

            // LEGS
            [-0.095, 0.095].forEach(x => {
                const thigh = new THREE.Mesh(new THREE.CylinderGeometry(0.082, 0.078, 0.48, 32), materials.skin);
                thigh.position.set(x, 0.35, 0);
                thigh.rotation.z = x < 0 ? 0.04 : -0.04;
                thigh.castShadow = true;
                model.add(thigh);
            });

            // ARMS
            [-0.235, 0.235].forEach(x => {
                const arm = new THREE.Mesh(new THREE.CylinderGeometry(0.044, 0.040, 0.32, 28), materials.skin);
                arm.position.set(x, 1.28, 0);
                arm.rotation.z = x < 0 ? 0.28 : -0.28;
                arm.castShadow = true;
                model.add(arm);
            });

            scene.add(model);
            model.userData = { floatOffset: 0, breatheOffset: 0 };
        }

        function createLabels() {
            const container = document.getElementById('canvas').parentElement;
            Object.keys(measurements).forEach((key, i) => {
                const m = measurements[key];
                const label = document.createElement('div');
                label.className = 'label';
                label.id = `label-${key}`;
                label.innerHTML = `<span class="label-text">${key.toUpperCase()}</span><span class="label-value">${m.value}"</span><span class="label-desc">${m.desc}</span>`;
                container.appendChild(label);

                const line = document.createElement('div');
                line.className = 'line';
                line.id = `line-${key}`;
                container.appendChild(line);

                const ring = document.createElement('div');
                ring.className = 'ring';
                ring.id = `ring-${key}`;
                container.appendChild(ring);

                setTimeout(() => {
                    label.classList.add('show');
                    line.classList.add('show');
                    ring.classList.add('show');
                }, 600 + i * 250);
            });
        }

        function updateLabels() {
            if (!model || !labelsVisible) return;
            const container = document.getElementById('canvas');
            Object.keys(measurements).forEach(key => {
                const m = measurements[key];
                const worldPos = new THREE.Vector3(...m.pos);
                model.localToWorld(worldPos);
                const screenPos = worldPos.project(camera);
                const x = (screenPos.x * 0.5 + 0.5) * container.clientWidth;
                const y = (screenPos.y * -0.5 + 0.5) * container.clientHeight;

                const label = document.getElementById(`label-${key}`);
                label.style.left = (x + 50) + 'px';
                label.style.top = (y - 20) + 'px';

                const line = document.getElementById(`line-${key}`);
                line.style.left = x + 'px';
                line.style.top = y + 'px';
                line.style.width = '50px';

                const ring = document.getElementById(`ring-${key}`);
                const size = m.value * 3.2;
                ring.style.width = size + 'px';
                ring.style.height = size + 'px';
                ring.style.left = (x - size / 2) + 'px';
                ring.style.top = (y - size / 2) + 'px';
            });
        }

        function setupControls() {
            const canvas = renderer.domElement;
            let isDragging = false, prevMouse = { x: 0, y: 0 };

            canvas.addEventListener('mousedown', () => { isDragging = true; autoRotate = false; });
            canvas.addEventListener('mousemove', e => {
                if (isDragging && model) {
                    model.rotation.y += (e.clientX - prevMouse.x) * 0.007;
                    model.rotation.x += (e.clientY - prevMouse.y) * 0.007;
                    model.rotation.x = Math.max(-0.4, Math.min(0.4, model.rotation.x));
                }
                prevMouse = { x: e.clientX, y: e.clientY };
            });
            document.addEventListener('mouseup', () => isDragging = false);
            canvas.addEventListener('wheel', e => {
                e.preventDefault();
                camera.position.z = Math.max(3, Math.min(7, camera.position.z + e.deltaY * 0.004));
            });

            // Touch
            let touchDist = 0;
            canvas.addEventListener('touchstart', e => {
                if (e.touches.length === 1) {
                    isDragging = true;
                    autoRotate = false;
                    prevMouse = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                } else if (e.touches.length === 2) {
                    touchDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
                }
            });
            canvas.addEventListener('touchmove', e => {
                e.preventDefault();
                if (isDragging && e.touches.length === 1 && model) {
                    model.rotation.y += (e.touches[0].clientX - prevMouse.x) * 0.007;
                    model.rotation.x += (e.touches[0].clientY - prevMouse.y) * 0.007;
                    model.rotation.x = Math.max(-0.4, Math.min(0.4, model.rotation.x));
                    prevMouse = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                } else if (e.touches.length === 2) {
                    const newDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
                    camera.position.z = Math.max(3, Math.min(7, camera.position.z + (touchDist - newDist) * 0.01));
                    touchDist = newDist;
                }
            });
            canvas.addEventListener('touchend', () => isDragging = false);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (model) {
                if (autoRotate) model.rotation.y += 0.0035;
                model.userData.floatOffset += 0.01;
                model.position.y = Math.sin(model.userData.floatOffset) * 0.01;
                model.userData.breatheOffset += 0.04;
                const breathe = 1 + Math.sin(model.userData.breatheOffset) * 0.004;
                model.scale.set(breathe, breathe, breathe);
                updateLabels();
            }
            renderer.render(scene, camera);
        }

        function toggleRotation() {
            autoRotate = !autoRotate;
            document.getElementById('btn-rotate').textContent = autoRotate ? '‚è∏' : '‚ñ∂';
        }

        function toggleLabels() {
            labelsVisible = !labelsVisible;
            Object.keys(measurements).forEach(key => {
                ['label', 'line', 'ring'].forEach(type => {
                    const el = document.getElementById(`${type}-${key}`);
                    if (labelsVisible) el.classList.add('show');
                    else el.classList.remove('show');
                });
            });
            document.getElementById('btn-labels').textContent = labelsVisible ? 'üëÅ' : 'üö´';
        }

        function resetView() {
            if (model) {
                model.rotation.set(0, 0, 0);
                camera.position.set(0.3, 1.6, 5);
                camera.lookAt(0, 1.5, 0);
                autoRotate = true;
                document.getElementById('btn-rotate').textContent = '‚è∏';
            }
        }

        function toggleWireframe() {
            wireframe = !wireframe;
            Object.values(materials).forEach(m => m.wireframe = wireframe);
            document.getElementById('btn-wire').style.opacity = wireframe ? '0.6' : '1';
        }

        window.addEventListener('DOMContentLoaded', () => setTimeout(init, 150));
        window.addEventListener('resize', () => {
            const container = document.getElementById('canvas');
            if (container && camera && renderer) {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        });
    </script>
</body>

</html>